<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:TalkBack.ViewModels"
             xmlns:services="clr-namespace:TalkBack.Services"
             x:Class="TalkBack.Views.ActionItemsPage"
             x:DataType="viewModel:ActionItemsPageViewModel"
             Title="Action Items"
             xmlns:mauiKit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             BackgroundColor="#F8F9FA">
    <Page.Behaviors>
        <mauiKit:StatusBarBehavior StatusBarColor="Black" />
    </Page.Behaviors>
    <Grid RowDefinitions="Auto,Auto,Auto,*">
        <!-- Modern Header with Gradient -->
        <!-- <Border Grid.Row="0"
                StrokeThickness="0"
                BackgroundColor="{StaticResource Primary}"
                Padding="20,20,20,16">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="0,0,24,24" />
            </Border.StrokeShape>
            <VerticalStackLayout Spacing="8">
                <Label Text="Action Items"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="White" />
                <HorizontalStackLayout Spacing="20">
                    <Border BackgroundColor="#FFFFFF30"
                            Padding="10,6"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Label Text="{Binding ActiveCount, StringFormat='{0} active'}"
                               FontSize="13"
                               TextColor="White"
                               FontAttributes="Bold" />
                    </Border>
                    <Border BackgroundColor="#FFFFFF20"
                            Padding="10,6"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Label Text="{Binding CompletedCount, StringFormat='{0} completed'}"
                               FontSize="13"
                               TextColor="White"
                               FontAttributes="Bold" />
                    </Border>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border> -->
        <!-- Modern Search Bar -->
        <Border Grid.Row="1"
                Margin="16,16,16,8"
                StrokeThickness="0"
                BackgroundColor="White"
                Padding="12,8"
                Shadow="{Shadow Brush=#15000000, Offset='0,2', Radius=12, Opacity=0.08}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="14" />
            </Border.StrokeShape>
            <Grid ColumnDefinitions="Auto,*,Auto"
                  ColumnSpacing="10">
                <Image Grid.Column="0"
                       Source="search.svg"
                       WidthRequest="18"
                       HeightRequest="18"
                       Opacity="0.5"
                       VerticalOptions="Center" />
                <Entry Grid.Column="1"
                       Text="{Binding SearchText}"
                       Placeholder="Search action items..."
                       FontSize="15"
                       VerticalOptions="Center"
                       BackgroundColor="Transparent" />
                <Border Grid.Column="2"
                        IsVisible="{Binding IsSearching}"
                        BackgroundColor="#F0F0F0"
                        Padding="6"
                        StrokeThickness="0"
                        VerticalOptions="Center">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ClearSearchCommand}" />
                    </Border.GestureRecognizers>
                    <Image Source="close.svg"
                           WidthRequest="16"
                           HeightRequest="16"
                           Aspect="AspectFit" />
                </Border>
            </Grid>
        </Border>
        <!-- Modern Toggle Button -->
        <Border Grid.Row="2"
                Margin="16,8"
                StrokeThickness="0"
                BackgroundColor="{StaticResource Primary}"
                Padding="16,12">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="12" />
            </Border.StrokeShape>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding ToggleCompletedCommand}" />
            </Border.GestureRecognizers>
            <Label Text="{Binding ShowCompleted, Converter={StaticResource ShowCompletedTextConverter}}"
                   TextColor="White"
                   FontSize="15"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </Border>
        <!-- Action Items List -->
        <CollectionView Grid.Row="3"
                        ItemsSource="{Binding ActionItems}"
                        SelectionMode="None"
                        Margin="16,8,16,16">
            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Spacing="16"
                                     Padding="40">
                    <Border BackgroundColor="#F0F4F8"
                            Padding="20"
                            StrokeThickness="0"
                            HorizontalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="30" />
                        </Border.StrokeShape>
                        <Image Source="empty.svg"
                               WidthRequest="64"
                               HeightRequest="64"
                               Opacity="0.5" />
                    </Border>
                    <Label Text="No action items"
                           FontSize="20"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="#2C3E50" />
                    <Label Text="Analyze a recording to extract action items"
                           FontSize="14"
                           TextColor="#7F8C8D"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="services:ActionItem">
                    <Border Padding="16"
                            Margin="0,6"
                            BackgroundColor="White"
                            StrokeThickness="0"
                            Shadow="{Shadow Brush=#10000000, Offset='0,2', Radius=10, Opacity=0.06}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="Auto,*,Auto"
                              RowDefinitions="Auto,Auto,Auto,Auto"
                              ColumnSpacing="12"
                              RowSpacing="8">
                            <!-- Modern Checkbox -->
                            <Border Grid.Row="0"
                                    Grid.RowSpan="4"
                                    Grid.Column="0"
                                    VerticalOptions="Start"
                                    Padding="2"
                                    StrokeThickness="0"
                                    BackgroundColor="Transparent">
                                <CheckBox IsChecked="{Binding IsCompleted}"
                                          Color="{StaticResource Primary}"
                                          VerticalOptions="Start">
                                    <CheckBox.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:ActionItemsPageViewModel}}, Path=ToggleActionItemCompleteCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </CheckBox.GestureRecognizers>
                                </CheckBox>
                            </Border>
                            <!-- Task Title -->
                            <Label Grid.Row="0"
                                   Grid.Column="1"
                                   Text="{Binding Task}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#2C3E50"
                                   LineBreakMode="WordWrap">
                                <Label.Triggers>
                                    <DataTrigger TargetType="Label"
                                                 Binding="{Binding IsCompleted}"
                                                 Value="True">
                                        <Setter Property="TextDecorations"
                                                Value="Strikethrough" />
                                        <Setter Property="TextColor"
                                                Value="#95A5A6" />
                                        <Setter Property="Opacity"
                                                Value="0.7" />
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                            <!-- Priority Badge -->
                            <Border Grid.Row="1"
                                    Grid.Column="1"
                                    BackgroundColor="{Binding Priority, Converter={StaticResource PriorityColorConverter}}"
                                    Padding="10,5"
                                    HorizontalOptions="Start"
                                    StrokeThickness="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="10" />
                                </Border.StrokeShape>
                                <Label Text="{Binding Priority, Converter={StaticResource PriorityTextConverter}}"
                                       FontSize="11"
                                       TextColor="White"
                                       FontAttributes="Bold" />
                            </Border>
                            <!-- Assigned To -->
                            <HorizontalStackLayout Grid.Row="2"
                                                   Grid.Column="1"
                                                   Spacing="6"
                                                   IsVisible="{Binding AssignedTo, Converter={StaticResource IsNotNullOrEmptyConverter}}">
                                <Border BackgroundColor="#EDF2F7"
                                        Padding="6"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Image Source="person.svg"
                                           WidthRequest="14"
                                           HeightRequest="14"
                                           Opacity="0.6" />
                                </Border>
                                <Label Text="{Binding AssignedTo}"
                                       FontSize="13"
                                       TextColor="#64748B"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <!-- Due Date -->
                            <HorizontalStackLayout Grid.Row="3"
                                                   Grid.Column="1"
                                                   Spacing="6"
                                                   IsVisible="{Binding DueDate, Converter={StaticResource IsNotNullOrEmptyConverter}}">
                                <Border BackgroundColor="#FEF3E7"
                                        Padding="6"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    <Image Source="calendar.svg"
                                           WidthRequest="14"
                                           HeightRequest="14"
                                           Opacity="0.7" />
                                </Border>
                                <Label Text="{Binding DueDate}"
                                       FontSize="13"
                                       TextColor="#64748B"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                            <!-- Compact Action Buttons -->
                            <HorizontalStackLayout Grid.Row="0"
                                                   Grid.Column="2"
                                                   VerticalOptions="Start"
                                                   Spacing="6">
                                <!-- Set Reminder Button -->
                                <Border BackgroundColor="#F0F4F8"
                                        Padding="8"
                                        StrokeThickness="0"
                                        IsVisible="{Binding DueDate, Converter={StaticResource IsNotNullOrEmptyConverter}}">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10" />
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:ActionItemsPageViewModel}}, Path=SetReminderCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Border.GestureRecognizers>
                                    <Image Source="bell.svg"
                                           WidthRequest="18"
                                           HeightRequest="18"
                                           Aspect="AspectFit" />
                                </Border>
                                <!-- View Recording Button -->
                                <Border BackgroundColor="#E8F5E9"
                                        Padding="8"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10" />
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:ActionItemsPageViewModel}}, Path=ViewRecordingCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Border.GestureRecognizers>
                                    <Image Source="play.svg"
                                           WidthRequest="18"
                                           HeightRequest="18"
                                           Aspect="AspectFit" />
                                </Border>
                                <!-- Delete Button -->
                                <Border BackgroundColor="#FFEBEE"
                                        Padding="8"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10" />
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:ActionItemsPageViewModel}}, Path=DeleteActionItemCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Border.GestureRecognizers>
                                    <Image Source="delete.svg"
                                           WidthRequest="18"
                                           HeightRequest="18"
                                           Aspect="AspectFit" />
                                </Border>
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>